using System;
using System.ComponentModel;
using System.Data;
using System.Xml.Serialization;
using System.Reflection;
using System.Collections;
using System.Collections.ObjectModel;
using System.Collections.Generic;
using System.Text;
using Newtonsoft.Json.Linq;
using System.Runtime.Serialization;

namespace V8Gate {

	[Serializable]
	public class ѕарам«апроса {

		public string »м€;
		public object «нач;

		public ѕарам«апроса(string а»м€, object а«нач) {
			»м€ = а»м€;
			«нач = а«нач;
		}
	}

	public sealed class SkipAttribute : Attribute {
	}

	public sealed class IsV8FieldAttribute : Attribute {
	}

	public sealed class IsV8FieldTablePartAttribute : Attribute {
	}
	
	public sealed class IsV8PropAttribute : Attribute {
	}

	public sealed class IsV8PropTablePartAttribute:Attribute {
	}

//	public class V8_MetaData{
//
//		public static Dictionary<string, Type> Dic=new Dictionary<string,Type>();
//		//static V8_MetaData() {
//		//  V8_MetaData.Dic.Add("CatalogRef.‘орматыЋистов",typeof(—пр—сылка_‘орматыЋистов));
//		//  Dic.Add("CatalogRef.‘орматы ниг", typeof(—пр—сылка_‘орматы ниг));
//		//  Dic.Add("EnumRef.ѕереплеты", typeof(ѕереч_ѕереплеты));
//		//  Dic.Add("DocumentRef.ƒоговорќƒѕ", typeof(ƒок—сылка_ƒоговорќƒѕ));
//		//}
//	}

	public static class ObjectCache {	

		private static Dictionary<ObjectRef, WeakReference> ObjCache = new Dictionary<ObjectRef, WeakReference>();

		public static void ƒобавить(ObjectRef —сылка, V8Object obj) {
			lock (ObjCache) {
				WeakReference WR = new WeakReference(obj);
				ObjCache.Add(obj.—сылка¬нутр, WR);
			}
		}

		private static void _ƒобавить(ObjectRef —сылка, V8Object obj) {
			WeakReference WR = new WeakReference(obj);
			ObjCache.Add(obj.—сылка¬нутр, WR);
		}

		public static “ипќбъекта Ќайти¬ еше<“ипќбъекта>(ObjectRef а—сылка) where “ипќбъекта : V8Object, new() {
			WeakReference WR;
			V8Object Obj=null;
			if (а—сылка.IsEmpty()) {
				Obj = new “ипќбъекта();
			}else {
				lock (ObjCache) {
					if (ObjectCache.ObjCache.TryGetValue(а—сылка, out WR)){
						if (WR.IsAlive) {
							Obj = (V8Object)WR.Target;
//              System.Diagnostics.Trace.WriteLine("ѕопал");
						}else{
							Obj = new “ипќбъекта();		//конструктор с параметром не жрЄт
							Obj.—сылка¬нутр = а—сылка;
							WR.Target=Obj;
						}
					}else {
						Obj = new “ипќбъекта();		//конструктор с параметром не жрЄт
						Obj.—сылка¬нутр = а—сылка;
						ObjectCache._ƒобавить(а—сылка, Obj);
					}
				}
			}
			return (“ипќбъекта)Obj;		 //не должен ли быть return внутри lock???
		}

		//		public static V8Object Ќайти¬ еше(V8Object obj){
		//			Type “ипќбъекта = obj.GetType(); 
		//			ObjectRef —сылка = obj.—сылка;
		//			V8Object Obj;
		//			if (—сылка.IsEmpty()) {
		//				Obj = (V8Object)Activator.CreateInstance(“ипќбъекта);
		//			} else if (!ObjectCache.ObjCache.TryGetValue(—сылка, out Obj)) {
		//				Obj = (V8Object)Activator.CreateInstance(“ипќбъекта);
		//				Obj.—сылка = —сылка;
		//				ObjectCache.ObjCache.Add(—сылка, Obj);
		//			}
		//			return Obj;
		//		}

		public static V8Object Ќайти¬ еше(ObjectRef oRef) {
			WeakReference WR;
			Type “ипќбъекта = oRef.“ипќбъекта();
			ObjectRef —сылка = oRef;
			V8Object Obj;
			//«ачем создавать новый экземпл€р класса, если пуста€ ссылка передана в аргументе метода? ©Andrew
			if (—сылка.IsEmpty()) {
				Obj = (V8Object)Activator.CreateInstance(“ипќбъекта);
			} else {
				lock (ObjCache) {
					if (ObjectCache.ObjCache.TryGetValue(—сылка, out WR)) {
						if (WR.IsAlive) {
							Obj = (V8Object)WR.Target;
//              System.Diagnostics.Trace.WriteLine("ѕопал");
						}
						else {
							Obj = (V8Object)Activator.CreateInstance(“ипќбъекта);
							Obj.—сылка¬нутр = —сылка;
							WR.Target = Obj;
						}
					} else {
						Obj = (V8Object)Activator.CreateInstance(“ипќбъекта);
						Obj.—сылка¬нутр = —сылка;
						ObjectCache._ƒобавить(—сылка, Obj);
					}                                    
				}
			}
			return Obj;							  //не должен ли быть return внутри lock???
		}
	}

	
	//	public static class  еш{
	//		public static T ѕроверить<T>(ObjectRef ссылка) where T : new() {
	//			V8Object Obj;
	//			if (!ObjectCache.ObjCache.TryGetValue(ссылка, out Obj)) {
	//				Obj = new T(ссылка);
	//				ObjectCache.ObjCache.Add(this, Obj);
	//			}
	//			return (T)Obj;
	//		}
	//	}

	interface IV8TablePart {
		//bool јктивна();
		Type ѕолучить—туктуру олонок();
		object ƒобавить();  //добавить новую строку, названо как в 1—
		void CopyTo(object obj);
	}

  [Serializable]
	public class TabList<T> : List<T>, ICloneable, IV8TablePart, ISerializable where T : “абл„асть, new() {
		//private bool _јктивна = false;

		#region "constructors"
		public TabList() {
		}

		public TabList(SerializationInfo info, StreamingContext context) {
			foreach (SerializationEntry field in info) {
				//this[int.Parse(field.Name)] = field.Value as T;
			}
		}
		#endregion

		public void GetObjectData(SerializationInfo info, StreamingContext context) {
			for (int i = 0; i < this.Count; i++) {
				info.AddValue(i.ToString(), this[i]);
			}
		}

		public object Clone() {
			TabList<T> result = new TabList<T>();
			foreach (T item in this) {
				result.Add((T)item.Clone());
			}
			return result;
		}

		public void CopyTo(object obj) {
			TabList<T> remObj = obj as TabList<T>;
			if (remObj == null) throw new ArgumentException("“абл. часть не того типа или null");

			T[] values = new T[this.Count];
			base.CopyTo(values);
			remObj.Clear();
			remObj.AddRange(values);
			//PropertyInfo[]  олонки = IA.ѕолучить—туктуру олонок().GetProperties(BindingFlags.Public | BindingFlags.Instance);
			//for (int j = 0; j < —войList.Count; j++) {
			//  object —во€—трока = —войList[j];
			//  object Ќова€—трока = IA.ƒобавить();
			//  foreach (PropertyInfo  олонка in  олонки) {
			//    object «начение =  олонка.GetValue(—во€—трока, null);
			//     олонка.SetValue(Ќова€—трока, «начение, null);
			//  }
			//}
		}

		public override bool Equals(object obj) {
			if (object.ReferenceEquals(obj, this)) return true;
			TabList<T> that = obj as TabList<T>;
			if (that == null || this.Count != that.Count) return false;
			for (int i = 0; i < this.Count; i++) {
				if (!object.Equals(this[i], that[i])) return false;
			}
			return true;
		}

		public override int GetHashCode() {
			if (this.Count == 0) return base.GetHashCode();
			int result = 0;
			foreach (T item in this) {
				if (item != null) result = result ^ item.GetHashCode();
			}
			return result;
		}

		//bool IV8TablePart.јктивна() { return _јктивна; }
		Type IV8TablePart.ѕолучить—туктуру олонок() { return typeof(T); }
		object IV8TablePart.ƒобавить() {
			T Ќова€—трока = new T();
			this.Add(Ќова€—трока);
			return Ќова€—трока;
		}

		public static implicit operator TabList<T>(Collection<T> list) {
			TabList<T> “абл„асть = new TabList<T>();
			foreach (T var in list) {
				“абл„асть.Add(var);
			}
			return “абл„асть;
		}

		//		public bool јктивна {
		//			get { return _јктивна; }
		//			set { _јктивна = value; }
		//		}
	}

	public class “абл„асть : INotifyPropertyChanged, ICloneable, ISerializable {
		public event PropertyChangedEventHandler PropertyChanged;

		protected void NotifyPropertyChanged(String info) {
			if (PropertyChanged != null) {
				PropertyChanged(this, new PropertyChangedEventArgs(info));
			}
		}

		#region "constructors"
		public “абл„асть() {
		}

		public “абл„асть(SerializationInfo info, StreamingContext context) {
			JsonHelper.DeserializeV8(this, info, context);
		}
		#endregion

		public void GetObjectData(SerializationInfo info, StreamingContext context) {
			foreach (FieldInfo fi in this.GetType().GetFields(BindingFlags.Instance | BindingFlags.NonPublic)) {
				object value = fi.GetValue(this);
				if (value != null) {
					info.AddValue(fi.Name.Remove(0, 1), value);
				}
			}
		}

		public object Clone() {
			“абл„асть result = (“абл„асть)this.MemberwiseClone();
			//Type resultType = result.GetType();
			//FieldInfo[] fields = this.GetType().GetFields(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
			//foreach (FieldInfo field in fields) {
			//  if (!field.FieldType.IsValueType) {
			//    ICloneable fieldValue = field.GetValue(this) as ICloneable;
			//    object newValue = fieldValue == null ? null : fieldValue.Clone();
			//    resultType.GetField(field.Name, BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy).SetValue(result, newValue);
			//  }
			//}
			return result;
		}

		//©Andrew
		public override bool Equals(object obj) {
			if (object.ReferenceEquals(obj, this)) return true;
			“абл„асть that = obj as “абл„асть;
			if (that == null) return false;

			foreach (FieldInfo field in GetType().GetFields(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy)) {
				if (!object.Equals(field.GetValue(this), field.GetValue(that))) return false;
			}
			//PropertyInfo[] properties = this.GetType().GetProperties();
			//for (int i = 0; i < properties.Length; i++) {
			//  object thisPropVal = properties[i].GetValue(this, null);
			//  object thatPropVal = properties[i].GetValue(that, null);
			//  if (!object.Equals(thisPropVal, thatPropVal)) return false;
			//}
			return true;
		}

		public override int GetHashCode() {
			int result = 0;
			//PropertyInfo[] properties = this.GetType().GetProperties();
			//if (properties.Length == 0) return base.GetHashCode();
			//for (int i = 0; i < properties.Length; i++) {
			//  object thisPropVal = properties[i].GetValue(this, null);
			//  if (thisPropVal != null) result = result ^ thisPropVal.GetHashCode();
			//}
			foreach (FieldInfo field in GetType().GetFields()) {
				object value = field.GetValue(this);
				if (value != null) result = result ^ value.GetHashCode();
			}

			return result;
		}
	}

	public interface I од<type> {
		type  од {
			get;
			set;
		}
	}

	public interface I од„исло : I од<decimal> {
	}

	public interface I од—трока : I од<string> {
	}

	public interface IЌомер<type> {
		type Ќомер {
			get;
			set;
		}
	}

	public interface IЌомер„исло : IЌомер<decimal> {
	}

	public interface IЌомер—трока : IЌомер<string> {
	}

	public interface IЌаименование {
		string Ќаименование {
			get;
			set;
		}
	}

	public class CancelEvArgs: EventArgs {
		private bool _cancel;

		public bool Cancel {
			get {
				return _cancel;
			}
			set {
				_cancel = value;
			}
		}

		public CancelEvArgs() {
			_cancel = false;
		}
	}

	public abstract class V8Object:ISerializable, IDeserializationCallback, INotifyPropertyChanged, ICloneable {
		public event PropertyChangedEventHandler PropertyChanged;
		private SerializationInfo _sinfo;
		private StreamingContext _scontext;
		public event EventHandler ѕосле«аписи;
		public event EventHandler<CancelEvArgs> ѕеред«аписью; //©Andrew
		public event EventHandler ѕосле«агрузки;

//    ~V8Object() {
//      System.Diagnostics.Trace.WriteLine("ќбъект "+this.GetType().Name+" уничтожен сборщиком мусора");
//    }

		[IsV8Field]
		internal ObjectRef _—сылка;

//		[IsV8Prop]
		internal ObjectRef —сылка¬нутр {
			[System.Diagnostics.DebuggerHidden]
			get { return _—сылка; }
			[System.Diagnostics.DebuggerHidden]
			set { _—сылка = value; }
		}

		//begin------------------------©Andrew-----------------------------------------
		[IsV8Field]
		internal bool? _ѕометка”далени€;

		[IsV8Prop]
		public bool ѕометка”далени€ {
			get {
				if (_ѕометка”далени€ == null) {
					ѕометка”далени€ = DAL.Instance.ѕолучитьѕоле<bool>(—сылка¬нутр, "ѕометка”далени€");
				}
				return _ѕометка”далени€.Value;
			}
			set {
				if (_ѕометка”далени€ != value) {
					_ѕометка”далени€ = value;
					NotifyPropertyChanged("ѕометка”далени€");
				}
			}
		}
		//end------------------------©Andrew-----------------------------------------

		//~V8Object(){
		//  string d=this.GetType().ToString()+" ";
		//  if (this is ƒокумент){
		//    d=d+((ƒокумент)this).ƒата.ToString();
		//  }else if (this is —правочник) {
		//    d=d+((—правочник)this).Ќаименование;
		//  }
		//  System.Diagnostics.Trace.WriteLine("”далено " + d);
		//}

		public object Clone() {
			V8Object result = (V8Object)this.MemberwiseClone();

			foreach (FieldInfo field in result.ѕол€“абл„асти) {
				ICloneable fieldValue = field.GetValue(result) as ICloneable;
				field.SetValue(result, fieldValue != null ? fieldValue.Clone() : null);
			}
			//Type resultType = result.GetType();
			//FieldInfo[] fields = this.GetType().GetFields(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
			//foreach (FieldInfo field in fields) {
			//  if (!field.FieldType.IsValueType) {
			//    ICloneable fieldValue = field.GetValue(this) as ICloneable;
			//    object newValue = fieldValue == null ? null : fieldValue.Clone();
			//    resultType.GetField(field.Name, BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy).SetValue(result, newValue);
			//  }
			//}
			return result;
		}

		public void CopyTo(V8Object obj) {
			Type objType = obj.GetType();
			for (int i = 0; i < this.ѕол€Ўапки.Length; i++) {
				obj.ѕол€Ўапки[i].SetValue(obj, this.ѕол€Ўапки[i].GetValue(this));
			}
			foreach (FieldInfo поле in this.ѕол€“абл„асти) {
				IV8TablePart thisValue = поле.GetValue(this) as IV8TablePart;
				if (thisValue != null) {
					object difValue = Activator.CreateInstance(поле.FieldType);
					thisValue.CopyTo(difValue);
					поле.SetValue(obj, difValue);
				} else {
					поле.SetValue(obj, null);
				}
			}
			//PropertyInfo[] ћои“абл„ = this.—войства“абл„асти;
			//PropertyInfo[] „ужие“абл„ = obj.—войства“абл„асти;
			//for (int i=0; i < ћои“абл„.Length; i++) {
			//  PropertyInfo ћо€“абл„=ћои“абл„[i];
			//  PropertyInfo „ужа€“абл„=„ужие“абл„[i];
			//  IList —войList = (IList)ћо€“абл„.GetValue(this, null);
			//  IList „ужойList = (IList)„ужа€“абл„.GetValue(obj, null);
			//  IV8TablePart IA = (IV8TablePart)„ужойList;
			//  „ужойList.Clear();
			//  PropertyInfo[]  олонки = IA.ѕолучить—туктуру олонок().GetProperties(BindingFlags.Public | BindingFlags.Instance);
			//  for (int j = 0; j < —войList.Count; j++) {
			//    object —во€—трока =—войList[j];
			//    object Ќова€—трока = IA.ƒобавить();
			//    foreach (PropertyInfo  олонка in  олонки) {
			//      object «начение= олонка.GetValue(—во€—трока, null);
			//       олонка.SetValue(Ќова€—трока, «начение, null);
			//    }
			//  }
			//}
		}

		public override bool Equals(object obj) {
			if (object.ReferenceEquals(obj, this)) return true;
			V8Object that = obj as V8Object;
			if (that == null) return false;

			foreach (FieldInfo field in ѕол€Ўапки) {
				if (!object.Equals(field.GetValue(this), field.GetValue(that))) return false;
			}
			foreach (FieldInfo field in ѕол€“абл„асти) {
				if (!object.Equals(field.GetValue(this), field.GetValue(that))) return false;
			}
			//PropertyInfo[] properties = new PropertyInfo[this.—войстваЎапки.Length + this.—войства“абл„асти.Length];
			//this.—войстваЎапки.CopyTo(properties, 0);
			//this.—войства“абл„асти.CopyTo(properties, this.—войстваЎапки.Length);
			//for (int i = 0; i < properties.Length; i++) {
			//  object thisPropVal = properties[i].GetValue(this, null);
			//  object thatPropVal = properties[i].GetValue(that, null);
			//  if (!object.Equals(thisPropVal, thatPropVal)) return false;
			//}
			return true;
		}

		public override int GetHashCode() {
			int result = 0;
			foreach (FieldInfo field in ѕол€Ўапки) {
				object value = field.GetValue(this);
				if (value != null) result = result ^ value.GetHashCode();
			}
			foreach (FieldInfo field in ѕол€“абл„асти) {
				object value = field.GetValue(this);
				if (value != null) result = result ^ value.GetHashCode();
			}
			//PropertyInfo[] properties = new PropertyInfo[this.—войстваЎапки.Length + this.—войства“абл„асти.Length];
			//this.—войстваЎапки.CopyTo(properties, 0);
			//this.—войства“абл„асти.CopyTo(properties, this.—войстваЎапки.Length);
			//if (properties.Length == 0) return base.GetHashCode();

			//for (int i = 0; i < properties.Length; i++) {
			//  object value = properties[i].GetValue(this, null);
			//  if (value != null) result = result ^ value.GetHashCode();
			//}

			return result;
		}

		public static FieldInfo[] «апроситьѕол€<“ип, јтрибут>() {
			FieldInfo[] fi2 = typeof(“ип).GetFields(BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
			List<FieldInfo> —писокѕолей = new List<FieldInfo>(fi2.Length);
			foreach (FieldInfo f in fi2) {
				if (f.IsDefined(typeof(јтрибут), false)) {
					—писокѕолей.Add(f);
				}
			}
			FieldInfo[] res=new FieldInfo[—писокѕолей.Count];
			—писокѕолей.CopyTo(res);
			return res;
		}

		public static PropertyInfo[] «апросить—войства<“ип, јтрибут>() {
			PropertyInfo[] fi2 = typeof(“ип).GetProperties(BindingFlags.Public | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
			List<PropertyInfo> —писокѕолей = new List<PropertyInfo>(fi2.Length);
			foreach (PropertyInfo f in fi2) {
				if (f.IsDefined(typeof(јтрибут), false)) {
					—писокѕолей.Add(f);
				}
			}
			PropertyInfo[] res = new PropertyInfo[—писокѕолей.Count];
			—писокѕолей.CopyTo(res);
			return res;
		}

		public void GetObjectData(SerializationInfo info, StreamingContext context) {
			foreach (FieldInfo fi in this.ѕол€Ўапки) {
				object value = fi.GetValue(this);
				if (value != null) {
					//info.AddValue(fi.Name.Substring(1), fi.GetValue(this));
					//Remove(0, 1) - убираем _ в имени пол€
					info.AddValue(fi.Name.Remove(0, 1), value);
				}
			}
			foreach (FieldInfo fi in ѕол€“абл„асти) {
				object value = fi.GetValue(this);
				if (value != null) {
					//info.AddValue(fi.Name.Remove(0, 1), value);
					//Remove(0, 1) - убираем _ в имени пол€
					info.AddValue(fi.Name.Remove(0, 1), value);
				}
			}
			//foreach (PropertyInfo T in this.—войства“абл„асти) {
			//  info.AddValue(T.Name, T.GetValue(this, null));
			//}
		}

		public V8Object(SerializationInfo info, StreamingContext context) {
			_sinfo = info;
			_scontext = context;
			//foreach (PropertyInfo fi in this) {
			//  fi.SetValue(this, info.GetValue(fi.Name, fi.PropertyType), null);
			//}
			//foreach (SerializationEntry fi in info) {
			//  PropertyInfo pi = this.GetType().GetProperty(fi.Name, BindingFlags.Public | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
			//  pi.SetValue(this, fi.Value, null);
			//}
			OnDeserialization(this);
		}

		public void OnDeserialization(object sender) {
			//foreach (FieldInfo fi in this) {
			//  fi.SetValue(this, _sinfo.GetValue(fi.Name, fi.FieldType));
			//}
			//foreach (SerializationEntry var in _sinfo) {
			//  PropertyInfo fi = this.GetType().GetProperty(var.Name, BindingFlags.Public | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
			//  fi.SetValue(this, var.Value, null);
			//}

			//foreach (SerializationEntry field in _sinfo) {
			//  Type fieldType = this.GetType();
			//  FieldInfo fi = fieldType.GetField('_' + field.Name, BindingFlags.Instance | BindingFlags.NonPublic);
			//  PropertyInfo pi = fieldType.GetProperty(field.Name, BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public);
			//  if (fi != null && pi != null) {
			//    object value;

			//    if (!JsonHelper.TryDeserializeJson(field.Value as JToken, pi.PropertyType, out value)) {
			//      value = field.Value;
			//    }

			//    fi.SetValue(this, value);
			//  }
			//}
			JsonHelper.DeserializeV8(this, _sinfo, _scontext);
		}

		protected void NotifyPropertyChanged(String info) {
			if (PropertyChanged != null) {
				PropertyChanged(this, new PropertyChangedEventArgs(info));
			}
		}
		
		//public T ѕолучитьѕоле<T>(string aName) {
		//  DbConnections pool = DbConnections.Instance;
		//  DbConnection con = pool.ConnectV8();
		//  object V8Ref = V8A.Reference(—сылка, con);
		//  object result = V8A.Get(V8Ref, aName);
		//  object value = V8A.ConvertValueV8ToNet(result, con, typeof(T));
		//  pool.ReturnDBConnection(con);
		//  return (T)value;
		//}

		public V8Object() {
		}
		
		public V8Object(ObjectRef а—сылка) {
			if (а—сылка == null) {
				ArgumentException ae = new ArgumentException("ѕопытка создать объект из ссылки NULL");
			}
			—сылка¬нутр = а—сылка;
		}

		public virtual FieldInfo[] ѕол€Ўапки{
			get{
				return null;
			}
		}

		public virtual PropertyInfo[] —войстваЎапки {
			get{
				return null;
			}
		}

		public virtual FieldInfo[] ѕол€“абл„асти {
			get {
				return null;
			}
		}

		public virtual PropertyInfo[] —войства“абл„асти {
			get{
				return null;
			}
		}

		//public IEnumerator<PropertyInfo> GetEnumerator() {
		//  PropertyInfo[] fi2 = this.GetType().GetProperties(BindingFlags.Public | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
		//  foreach (PropertyInfo f in fi2) {
		//    if (f.IsDefined(typeof(IsV8PropAttribute), false)) {
		//      yield return f;
		//    }
		//  }
		//}

		//public IEnumerable<PropertyInfo> “абличные„асти() {
		//  PropertyInfo[] fi2 = this.GetType().GetProperties(BindingFlags.Public | BindingFlags.Instance);
		//  foreach (PropertyInfo f in fi2) {
		//    if (f.IsDefined(typeof(IsV8PropTablePartAttribute), false)) {
		//      IV8TablePart IT=f.GetValue(this, null) as IV8TablePart;
		//      //if (IT.јктивна()){
		//        yield return f;
		//      //}
		//    }
		//  }
		//}

		//public IEnumerable<FieldInfo> ѕол€Ўапки() {
		//  FieldInfo[] fi2 = this.GetType().GetFields(BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
		//  foreach (FieldInfo f in fi2) {
		//    if (f.IsDefined(typeof(IsV8FieldAttribute), false)) {
		//      yield return f;
		//    }
		//  }
		//}

		public void Load(DAL dal) {
			if (this.—сылка¬нутр.IsEmpty()) return;//©Andrew

			V8Object obj = dal.Load(—сылка¬нутр);
			if (!object.ReferenceEquals(obj, this)) { //©Andrew (при пр€мом обращении - obj и this эквивалентны)
				//if (TestDALs.CurDAL is IRemoteDAL) {
				//PropertyInfo[] fi = obj.GetType().GetProperties(BindingFlags.Public | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
				//foreach (PropertyInfo fld in obj.—войстваЎапки) {
				//  fld.SetValue(this, fld.GetValue(obj, null), null);
				//}
				//foreach (PropertyInfo fld in obj.—войства“абл„асти) {
				//  IList tp = fld.GetValue(obj, null) as IList;
				//  if (tp == null) {
				//    fld.SetValue(this, fld.GetValue(obj, null), null);
				//  } else {
				//    CopyAll((IList)fld.GetValue(this, null), (IEnumerable)fld.GetValue(obj, null));
				//  }
				//}
				obj.CopyTo(this);
			}
			//}
			if (ѕосле«агрузки != null) {
				ѕосле«агрузки(this, EventArgs.Empty);
			}
		}

		public void Load() {
			Load(DAL.Instance);
		}

		//		public void Load() {
		//			DbConnections pool = DbConnections.Instance;
		//			DbConnection con = pool.ConnectV8();
		//			object V8Ref = V8A.Reference(—сылка, con);
		//
		//			foreach (FieldInfo fi in this) {
		//				object result = V8A.Get(V8Ref, fi.Name.Substring(1));
		//				object value = V8A.ConvertValueV8ToNet(result, con, fi.FieldType);
		//				fi.SetValue(this, value);
		//			}
		//			foreach (FieldInfo T in “абличные„асти()) {
		//				IList TR = (IList)T.GetValue(this);
		//				IV8TablePart IA = (IV8TablePart)TR;
		//				if (IA.јктивна()) {
		//					TR.Clear();
		//					FieldInfo[]  олонки = IA.ѕолучить—туктуру олонок().GetFields(BindingFlags.Public | BindingFlags.Instance);
		//					object “аблична€„асть = V8A.Get(V8Ref, T.Name.Substring(1));
		//					int  оличество = (int)V8A.Get(“аблична€„асть, " оличество()");
		//					//дл€ каждой строки “аб„асти
		//					for (int i = 0; i <  оличество; i++) {
		//						object —трока“абл„асти = V8A.Get(“аблична€„асть, "ѕолучить()", i);
		//						object Ќова€—трока=IA.ƒобавить();
		//						foreach (FieldInfo  олонка in  олонки) {
		//							object «начение = V8A.ConvertValueV8ToNet(V8A.Get(—трока“абл„асти,  олонка.Name), con,  олонка.FieldType);
		//							 олонка.SetValue(Ќова€—трока, «начение);
		//						}
		//					}
		//				}
		//			}
		//
		//			pool.ReturnDBConnection(con);
		//		}

		public void Load2(DAL dal) {
			if (this.—сылка¬нутр.IsEmpty()) return; //©Andrew

			V8Object obj = dal.Load2(this.—сылка¬нутр);
			if (!object.ReferenceEquals(obj, this)) { //©Andrew (при пр€мом обращении - obj и this эквивалентны)
				//if (TestDALs.CurDAL is IRemoteDAL) {
				//PropertyInfo[] fi = obj.GetType().GetProperties(BindingFlags.Public | BindingFlags.Instance | BindingFlags.FlattenHierarchy);
				//foreach (PropertyInfo fld in obj.—войстваЎапки) {
				//  fld.SetValue(this, fld.GetValue(obj, null), null);
				//}
				//foreach (PropertyInfo fld in obj.—войства“абл„асти) {
				//  IList tp = fld.GetValue(obj, null) as IList;
				//  if (tp == null) {
				//    fld.SetValue(this, fld.GetValue(obj, null), null);
				//  } else {
				//    CopyAll((IList)fld.GetValue(this, null), (IEnumerable)fld.GetValue(obj, null));
				//  }
				//}
				obj.CopyTo(this);
			}
			//}
			if (ѕосле«агрузки != null) {
				ѕосле«агрузки(this, EventArgs.Empty);
			}
		}

		public void Load2() {
			Load2(DAL.Instance);
		}

		//©Andrew
		private void CopyAll(IList dest, IEnumerable source) {
			dest.Clear();
			foreach(object item in source) {
				dest.Add(item);
			}
		}

		//		public void Load2() {
		//			string[] „асть»мени=—сылка.GetType().Name.Split(new char[] { '_' });
		//			string ѕрефикс“аблицы = „асть»мени[0];  //здесь —пр или ƒок
		//			string »м€“аблицы=„асть»мени[1];
		//			if (ѕрефикс“аблицы.StartsWith("—пр")) {
		//				ѕрефикс“аблицы="—правочник.";
		//			} else if (ѕрефикс“аблицы.StartsWith("ƒок")) {
		//				ѕрефикс“аблицы="ƒокумент.";
		//			}
		//			StringBuilder “екст«апроса = new StringBuilder("¬џЅ–ј“№ "+»м€“аблицы + ".ѕредставление", 2000);
		//			foreach (FieldInfo fi in this) {
		//				Type “ипѕол€ = fi.FieldType;
		//				string fldName = fi.Name.Substring(1);
		//				“екст«апроса.Append("," + »м€“аблицы + "." + fldName);
		//				if (“ипѕол€.IsSubclassOf(typeof(ObjectRef))) {
		//					“екст«апроса.Append(","+»м€“аблицы+"."+fldName+".ѕредставление");
		//				}
		//			}
		//
		//			foreach (FieldInfo T in “абличные„асти()) {
		//				“екст«апроса.Append("," + »м€“аблицы + "." + T.Name.Substring(1) + ".(");
		//				IList TR = (IList)T.GetValue(this);
		//				IV8TablePart IA = (IV8TablePart)TR;
		//				if (IA.јктивна()) {
		//					string –азделитель2 = "";
		//					FieldInfo[]  олонки = IA.ѕолучить—туктуру олонок().GetFields(BindingFlags.Public | BindingFlags.Instance);
		//					foreach (FieldInfo  олонка in  олонки) {
		//						string fldName =  олонка.Name;
		//						“екст«апроса.Append(–азделитель2 + fldName);
		//						–азделитель2 = ",";
		//						if ( олонка.FieldType.IsSubclassOf(typeof(ObjectRef))) {
		//							“екст«апроса.Append("," + fldName + ".ѕредставление");
		//						}
		//					}
		//				}
		//				“екст«апроса.Append(")");
		//			}
		//			“екст«апроса.Append(" »« " + ѕрефикс“аблицы + »м€“аблицы + "  ј  " + »м€“аблицы);
		//			“екст«апроса.Append(" √ƒ≈	" + »м€“аблицы + ".—сылка = &—сылка");
		//
		//			DbConnections pool = DbConnections.Instance;
		//			DbConnection con = pool.ConnectV8();
		//			object V8Ref = V8A.Reference(—сылка, con);
		//			ѕарам«апроса[] ѕар = new ѕарам«апроса[] { new ѕарам«апроса("—сылка", V8Ref) };
		//			object result = V8A.ѕолучить–езультат«апроса(con, “екст«апроса.ToString(), ѕар);
		//			object ¬ыборка = V8A.Get(result, "¬ыбрать()");
		//			if ((bool)V8A.Get(¬ыборка, "—ледующий()")) { //запрос должен вернуть ровно 1 строку
		//				int i=0;
		//				bool ѕервый–аз = true;
		//				foreach (FieldInfo fi in this) {
		//					if (ѕервый–аз) { //первым идЄт ѕредставление дл€ ссылки. —ама ссылка известна заранее
		//						ѕервый–аз = false;
		//						—сылка.ѕредставление = (string)V8A.ConvertValueV8ToNet(V8A.Get(¬ыборка, "ѕолучить()", i++), con, typeof(string));
		//					}
		//					object «начение = V8A.ConvertValueV8ToNet(V8A.Get(¬ыборка, "ѕолучить()", i++), con, fi.FieldType);
		//					fi.SetValue(this, «начение);
		//					ObjectRef oref = «начение as ObjectRef;
		//					if (oref != null) {//за ссылочным типом в следующем поле запроса должно быть ѕредставление
		//						oref.ѕредставление = (string)V8A.ConvertValueV8ToNet(V8A.Get(¬ыборка, "ѕолучить()", i++), con, typeof(string));
		//					}
		//				}
		//				foreach (FieldInfo T in “абличные„асти()) {
		//					IList TR = (IList)T.GetValue(this);
		//					IV8TablePart IA = (IV8TablePart)TR;
		//					if (IA.јктивна()) {
		//						TR.Clear();
		//						FieldInfo[]  олонки = IA.ѕолучить—туктуру олонок().GetFields(BindingFlags.Public | BindingFlags.Instance);
		//						object ¬лож–езульт«апроса = V8A.Get(¬ыборка, "ѕолучить()", i++);
		//						object ¬лож¬ыборка = V8A.Get(¬лож–езульт«апроса, "¬ыбрать()");
		//						while ((bool)V8A.Get(¬лож¬ыборка, "—ледующий()")) {
		//							object Ќова€—трока=IA.ƒобавить();
		//							int j = 0;
		//							foreach (FieldInfo  олонка in  олонки) {
		//								object «начение = V8A.ConvertValueV8ToNet(V8A.Get(¬лож¬ыборка, "ѕолучить()", j++), con,  олонка.FieldType);
		//								 олонка.SetValue(Ќова€—трока, «начение);
		//								ObjectRef oref = «начение as ObjectRef;
		//								if (oref != null) {//за ссылочным типом в следующем поле запроса должно быть ѕредставление
		//									oref.ѕредставление = (string)V8A.ConvertValueV8ToNet(V8A.Get(¬лож¬ыборка, "ѕолучить()", j++), con, typeof(string));
		//								}
		//							}
		//						}
		//					}
		//				}
		//			}
		//			pool.ReturnDBConnection(con);
		//		}

		//©Andrew
		protected bool Onѕеред«аписью() {
			if (ѕеред«аписью != null) {
				CancelEvArgs _cancelEventArgs = new CancelEvArgs();
				ѕеред«аписью(this, _cancelEventArgs);
				return _cancelEventArgs.Cancel;
			}
			return false;
		}

		protected void Onѕосле«аписи() {
			if (ѕосле«аписи != null) {
				ѕосле«аписи(this, EventArgs.Empty);
			}
		}
	
	}
	[Serializable]
	public abstract class —правочник:V8Object {

		//[IsV8Field]
		//internal bool? _Ёто√руппа;

		//[IsV8Prop]
		//public bool Ёто√руппа {
		//  get {
		//    if (_Ёто√руппа == null) {
		//      _Ёто√руппа = TestDALs.CurDAL.ѕолучитьѕоле<bool>(—сылка, "Ёто√руппа");
		//    }
		//    return _Ёто√руппа.Value;
		//  }
		//  set { _Ёто√руппа = value; }
		//}

		//[IsV8Field]
		//internal string _Ќаименование=null;

		//[IsV8Prop]
		//public string Ќаименование {
		//  get {
		//    if (_Ќаименование == null) {
		//      Ќаименование = DAL.Instance.CurDAL.ѕолучитьѕоле<string>(—сылка, "Ќаименование");
		//    }
		//    return _Ќаименование;
		//  }
		//  set {
		//    if (_Ќаименование != value) {
		//      _Ќаименование = value;
		//      NotifyPropertyChanged("Ќаименование");
		//    }
		//  }
		//}

		public —правочник(SerializationInfo info, StreamingContext context)
			: base(info, context) {
		}

		public —правочник(ObjectRef а—сылка)
			: base(а—сылка) {
		}

		public —правочник(){
		}

		public void «аписать(DAL dal) {
			if (!Onѕеред«аписью()) {//©Andrew
				this.—сылка¬нутр = dal.«аписать(this);
				//V8Object obj = TestDALs.CurDAL.Load2(this);
				//if (DAL.Instance.CurDAL is IRemoteDAL) {
				//  this.—сылка = —сылка;
				//}
				Onѕосле«аписи();
			}
		}

		public void «аписать() {
			«аписать(DAL.Instance);
		}

	}

	public abstract class ƒокумент:V8Object {
		[IsV8Field]
		internal DateTime? _ƒата;

		[IsV8Prop]
		public DateTime ƒата {
			get {
				if (_ƒата == null) {
					ƒата = DAL.Instance.ѕолучитьѕоле<DateTime>(—сылка¬нутр, "ƒата");
				}
				return _ƒата.Value;
			}
			set {
				if (_ƒата != value) {
					_ƒата = value;
					NotifyPropertyChanged("ƒата");
				}
			}
		}

		public ƒокумент(SerializationInfo info, StreamingContext context)
			: base(info, context) {
		}
	
		public ƒокумент()
			: base() {
		}

		public ƒокумент(ObjectRef а—сылка)
			: base(а—сылка) {
		}

		public void «аписать(DAL dal, –ежим«аписиƒокумента а–еж«аписи, –ежимѕроведени€ƒокумента а–ежѕров) {
			if (!Onѕеред«аписью()) {//©Andrew
				this.—сылка¬нутр = dal.«аписатьƒокумент(this, а–еж«аписи, а–ежѕров);
				//V8Object obj = TestDALs.CurDAL.Load2(this);
				//if (DAL.Instance.CurDAL is IRemoteDAL) {
				//  this.—сылка = —сылка;
				//}
				Onѕосле«аписи();
			}
		}

		public void «аписать(–ежим«аписиƒокумента а–еж«аписи, –ежимѕроведени€ƒокумента а–ежѕров) {
			«аписать(DAL.Instance, а–еж«аписи, а–ежѕров);
		}
	}

	[System.Serializable()]
	public abstract class ObjectRef:IComparable, ISerializable, ICloneable
 {
		#region Fields
		private Guid m_uuid;
		private string _ѕредставление=string.Empty;

		//public abstract string ѕолеѕредставлени€ { get; }
		#endregion

		#region Properties
		public string ѕредставление {
			[System.Diagnostics.DebuggerHidden]
			get { return _ѕредставление; }
			[System.Diagnostics.DebuggerHidden]
			set { _ѕредставление = value; }
		}

		[System.Xml.Serialization.XmlTextAttribute()]
		public Guid UUID {
			get {
				return this.m_uuid;
			}
			set {
				this.m_uuid = value;
			}
		}
		#endregion

		#region Constructors
		public ObjectRef(SerializationInfo info, StreamingContext context) {
			//object uuid = info.GetValue("G", typeof(object));
			//object предст = info.GetValue("ѕ", typeof(object));
			//if (uuid is JValue) {
			//  uuid = ((JValue)uuid).Value;
			//}
			//if (uuid is JValue) {
			//  предст = ((JValue)предст).Value;
			//}

			//if (uuid is Guid) {
			//  this.m_uuid = (Guid)uuid;
			//} else if (uuid is string) {
			//  this.m_uuid = new Guid((string)uuid);
			//} else {
			//  throw new ArgumentException("Guid у ссылки не может быть типа " + uuid.GetType().FullName);
			//}
			//this._ѕредставление = предст.ToString();
			this.m_uuid = (Guid)JsonHelper.DeserializeValue(info.GetValue("G", typeof(object)), typeof(Guid));
			this._ѕредставление = info.GetString("ѕ");
			//this.m_uuid = (Guid)info.GetValue("G", typeof(Guid));
			//this._ѕредставление = info.GetString("ѕ");

			//foreach (SerializationEntry field in info) {
			//  Type fieldType = this.GetType();
			//  FieldInfo fi = fieldType.GetField('_' + field.Name, BindingFlags.Instance | BindingFlags.NonPublic);
			//  if (fi != null) {
			//    JToken jValue = field.Value as JToken;
			//    if (jValue != null && jValue.HasValues && typeof(ISerializable).IsAssignableFrom(fi.FieldType)) {
			//      SerializationInfo serializationInfo = new SerializationInfo(fieldType, new System.Runtime.Serialization.FormatterConverter());
			//      foreach (JToken token in jValue.Children()) {
			//        JProperty prop = token as JProperty;
			//        if (prop != null) {
			//          serializationInfo.AddValue(prop.Name, prop.Value);
			//        } else {
			//          throw new ArgumentException("JToken appeared to be not property");
			//        }
			//      }
			//    } else {
			//      fi.SetValue(this, field.Value);
			//    }
			//  }
			//}

		}

		public ObjectRef() {
			this.m_uuid = Guid.Empty;
		}

		public ObjectRef(Guid uuid) {
			this.m_uuid = uuid;
		}
		#endregion

		#region Methods
		public abstract string ѕолучитьѕредставление();
		//public virtual string ѕолучитьѕредставление() {
		//  return DAL.Instance.ѕолучитьѕоле<string>(this, this.ѕолеѕредставлени€);
		//}

		public virtual Type “ипќбъекта() {
			return typeof(V8Object);
		}

		public override string ToString() {
			if (this.IsEmpty()) {
				return string.Empty;
			}else if (string.IsNullOrEmpty(this.ѕредставление)) {
				return this.UUID.ToString();
			} else {
				return this.ѕредставление;
			}
		}

		public void GetObjectData(SerializationInfo info, StreamingContext context) {
			info.AddValue("G", this.m_uuid);
			info.AddValue("ѕ", this._ѕредставление);
			info.AddValue("T", this.GetType().AssemblyQualifiedName);
		}

		public virtual int CompareTo(object obj) {
			int i;
			Guid theGuid;
			if (obj != null) {
				if (object.ReferenceEquals(this, obj)) {
					return 0;
				} else {
					i = base.GetType().Name.CompareTo(obj.GetType().Name);
					if (i != 0) {
						return i;
					} else {
						theGuid = this.UUID;
						return theGuid.CompareTo(((ObjectRef)obj).UUID);
					}
				}
			}
			throw new ArgumentException("err_NotObjectRef");	 //!!! было получение локализованной строки
		}

		public static bool operator ==(ObjectRef first, ObjectRef second) {
			if (ObjectRef.ReferenceEquals(first, null))
				return ObjectRef.ReferenceEquals(second, null);
			return first.Equals(second);
		}

		public static bool operator !=(ObjectRef first, ObjectRef second) {
			return !(first == second);
		}

		public override bool Equals(object obj) {
			if (obj == null) {
				return false;
			} else if (object.ReferenceEquals(this, obj)) {
				return true;
			} else if (object.ReferenceEquals(base.GetType(), obj.GetType())) {
				return this.UUID.Equals(((ObjectRef)obj).UUID);
			} else {
				return false;
			}
		}

		[System.Diagnostics.DebuggerHidden]
		public override int GetHashCode() {
			return this.UUID.GetHashCode();
		}

		[System.Diagnostics.DebuggerHidden]
		public bool IsEmpty() {
			return (this.m_uuid == Guid.Empty);
		}

		public object Clone() {
			return this.MemberwiseClone();
		}
		//			public string Presentation(object connection)
		//			{
		//				object[] theObjectArray;
		//				bool theBoolean = (connection.State == ConnectionState.Closed);
		//				if(theBoolean)
		//				{
		//					connection.Open();
		//				}
		//				try
		//				{
		//					using(ComObject theComObject = this.Reference(connection))
		//					{
		//						theObjectArray = new object[] { theComObject.comObject };
		//						return ((string) V81.Call(connection.Connection, "String", theObjectArray));
		//					}
		//				}
		//				finally
		//				{
		//					if(theBoolean)
		//					{
		//						connection.Close();
		//					}
		//				}
		//			}

		//			public ComObject Reference(V8DbConnection connection)
		//			
		//			{
		//				ComObject theComObject;
		//				bool theBoolean = (connection.State == ConnectionState.Closed);
		//				if(theBoolean)
		//				{
		//					connection.Open();
		//				}
		//				try
		//				{
		//					theComObject = this.Reference(connection.Connection);
		//				}
		//				finally
		//				{
		//					if(theBoolean)
		//					{
		//						connection.Close();
		//					}
		//				}
		//				return theComObject;
		//			}

		//public string ToInvariantString()
		//{
		//  return V81.ToInvariantString(this.m_uuid);
		//}
		#endregion
	}

	[Serializable]
	public abstract class CatalogRef : ObjectRef {

		public CatalogRef(SerializationInfo info, StreamingContext context)
			:base(info, context) {
		}
		
		public CatalogRef()
			: base() {
		}

		public CatalogRef(Guid uuid)
			: base(uuid) {
		}

//		public void ЌайтиѕоЌаименованию(string аЌаим) {
//			CatalogRef obj = TestDALs.CurDAL.ЌайтиѕоЌаименованию(аЌаим);
//			this.UUID = obj.UUID;
//		}
	}

	public abstract class DocumentRef:ObjectRef {

		public DocumentRef(SerializationInfo info, StreamingContext context)
			: base(info, context) {
		}

		public DocumentRef()
			: base() {
		}

		public DocumentRef(Guid uuid)
			: base(uuid) {
		}

		public override string ѕолучитьѕредставление() {
			ѕредставление = DAL.Instance.ѕолучитьѕредставление«апросом(this);
			return ѕредставление;
		}

	}

	public abstract class StrNumDocRef:DocumentRef {

		public StrNumDocRef(SerializationInfo info, StreamingContext context)
			: base(info, context) {
		}

		public StrNumDocRef()
			: base() {
		}

		public StrNumDocRef(Guid uuid)
			: base(uuid) {
		}

		//		public void ЌайтиѕоЌомеру(string аЌомер, DateTime аƒата) {
		//			StrNumDocRef obj = TestDALs.CurDAL.ЌайтиѕоЌомеру(this, аЌомер, аƒата);
		//			this.UUID = obj.UUID;
		//		}
	}

	public abstract class IntNumDocRef:DocumentRef {

		public IntNumDocRef(SerializationInfo info, StreamingContext context)
			: base(info, context) {
		}

		public IntNumDocRef()
			: base() {
		}

		public IntNumDocRef(Guid uuid)
			: base(uuid) {
		}

		//		public void ЌайтиѕоЌомеру(int аЌомер, DateTime аƒата) {
		//			IntNumDocRef obj = TestDALs.CurDAL.ЌайтиѕоЌомеру(this, аЌомер, аƒата);
		//			this.UUID = obj.UUID;
		//		}
	}

	[Serializable]
	public abstract class IntNumCatRef : CatalogRef {

		public IntNumCatRef(SerializationInfo info, StreamingContext context)
			: base(info, context) {
		}

		public IntNumCatRef()
			: base() {
		}

		public IntNumCatRef(Guid uuid)
			: base(uuid) {
		}

		//		public void Ќайтиѕо оду(int а од) {
		//			CatalogRef obj = TestDALs.CurDAL.Ќайтиѕо оду(this, а од);
		//			this.UUID = obj.UUID;
		//		}

		//			string[] „асть»мени = this.GetType().Name.Split(new char[] { '_' });
		//			string »м€“аблицы = „асть»мени[1];
		//
		//			DbConnections pool = DbConnections.Instance;
		//			DbConnection con = pool.ConnectV8();
		//			object V8Ref = V8A.Reference(this, con);
		//			ObjectRef res=(ObjectRef)V8A.ConvertValueV8ToNet(V8A.Get(con, "—правочники."+»м€“аблицы+".Ќайтиѕо оду()", а од), con, this.GetType());
		//			this.UUID=res.UUID;
		//			pool.ReturnDBConnection(con);
		//		}

	}

	public abstract class StrNumCatRef : CatalogRef {
		public StrNumCatRef(SerializationInfo info, StreamingContext context)
			: base(info, context) {
		}

		public StrNumCatRef()
			: base() {
		}

		public StrNumCatRef(Guid uuid)
			: base(uuid) {
		}

		//		public void Ќайтиѕо оду(string а од) {
		//			CatalogRef obj = TestDALs.CurDAL.Ќайтиѕо оду(this, а од);
		//			this.UUID = obj.UUID;
		//		}

		//		public void Ќайтиѕо оду(string а од) {
		//			string[] „асть»мени = this.GetType().Name.Split(new char[] { '_' });
		//			string »м€“аблицы = „асть»мени[1];
		//
		//			DbConnections pool = DbConnections.Instance;
		//			DbConnection con = pool.ConnectV8();
		//			object V8Ref = V8A.Reference(this, con);
		//			ObjectRef res = (ObjectRef)V8A.ConvertValueV8ToNet(V8A.Get(con, "—правочники." + »м€“аблицы + ".Ќайтиѕо оду()", а од), con, this.GetType());
		//			this.UUID = res.UUID;
		//			pool.ReturnDBConnection(con);
		//		}
	}

}

